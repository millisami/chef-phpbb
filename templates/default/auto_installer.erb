require 'capybara'
require 'capybara/dsl'
require 'capybara/poltergeist'
require 'launchy'

Capybara.run_server = false
Capybara.default_driver = :poltergeist
Capybara.javascript_driver = :poltergeist
Capybara.app_host = '<%= @domain %>'

class PhpBBInstaller
  include Capybara::DSL

  # can be called as PhpBBInstaller.install
  def self.install
    visit('/install/index.php?mode=install&language=en')
    click_button("Proceed to next step")
    click_button("Start install")

    fill_in "dbhost", with: "<%= @db_host %>"
    fill_in "dbname", with: "<%= @db_name %>"
    fill_in "dbuser", with: "<%= @db_user %>"
    fill_in "dbpasswd", with: "<%= @db_password %>"

    fill_in "table_prefix", with: "forum_"
    click_button "Proceed to next step"

    click_button "Proceed to next step"

    fill_in "admin_name",   with: "<%= @admin_name %>"
    fill_in "admin_pass1",  with: "<%= @admin_pass1 %>"
    fill_in "admin_pass2",  with: "<%= @admin_pass2 %>"
    fill_in "board_email1", with: "<%= @board_email1 %>"
    fill_in "board_email2", with: "<%= @board_email2 %>"
    click_button "Proceed to next step"
    click_button "Proceed to next step"
    click_button "Proceed to next step"

    fill_in "server_name", with: "<%= @domain %>"
    click_button "Proceed to next step"
    click_button "Proceed to next step"
    click_button "Login"
  end
end
